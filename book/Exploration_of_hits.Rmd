# Exploration of GWLS hits

```{r, message = F, warning = F}
library(here)
source(here::here("book/source/04-Association_testing.R"))
```

## Read in data

### Get variables
```{r}
DATE_OF_ASSOC_TEST = 20220214
TARGET_PHENOS = c("unsegmented_psm_area")
names(TARGET_PHENOS) = TARGET_PHENOS
BIN_LENGTHS = c(5000)
names(BIN_LENGTHS) = BIN_LENGTHS
FILTERS = c("all_sites",
           "no_repeat_reads_or_pers_hets_filtered_for_read_count_and_cab_prop")
names(FILTERS) = FILTERS
```

### Read in files

```{r}
gwas_true = purrr::map(TARGET_PHENOS, function(PHENO){
  purrr::map(FILTERS, function(FILTER){
    # Get path to results directory
    RESULTS_DIR = file.path("/nfs/research/birney/users/ian/somites/association_testing", DATE_OF_ASSOC_TEST, FILTER, "true_results")
    # Read in results for each bin length
    purrr::map(BIN_LENGTHS, function(BIN_LENGTH){
      readRDS(file.path(RESULTS_DIR, PHENO, paste(BIN_LENGTH, ".rds", sep = "")))
    })
  })

})
```

#### Manhattans

Process data
```{r}
plot_dat = purrr::map(TARGET_PHENOS, function(PHENO){
  filter_list = purrr::map(FILTERS, function(FILTER){
    bin_list = purrr::map(FILTER, function(BIN_LENGTH){
      # clean GWAS results for plotting
      out = clean_gwas_res(gwas_true[[PHENO]][[as.character(BIN_LENGTH)]],
                           bin_length = BIN_LENGTH,
                           chr_lens = med_chr_lens)
      
      return(out)
    })
    names(bin_list) = bin_lengths
    
    return(bin_list)    
  })

})
names(plot_dat) = target_phenos
```

Read in significance levels from permutations

```{r}
perm_file = here::here("data", paste(date_of_assoc_test, "_permutation_mins.csv", sep = ""))
perms_df_mins = readr::read_csv(perm_file,
                                col_types = c("ccid"))
```

